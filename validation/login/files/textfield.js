define(["jquery","jqueryUI","buttonToggle"],function(e){"use strict";e.widget("pp.textField",{_create:function(){this._getElements(),this._addListeners(),this._load()},_getElements:function(){this.elements={},this.elements.parent=this.element,this.elements.input=this.element.find("input"),this.elements.helpErrors=this.element.find(".help-error"),this.elements.submitError=this.element.find(".error-submit"),this.elements.emptyError=this.element.find(".error-empty"),this.elements.formatError=this.element.find(".error-format"),this.elements.customError=this.element.find(".error-custom"),this.elements.helpInformation=this.element.find(".help-information");if(e(".oem").length>0){var t=e("<span/>",{"class":"clearIcon hide",id:this.elements.input.attr("id")+"_clear"});this.elements.clearIcon=t,e(this.elements.input).after(t)}},_addListeners:function(){this.elements.input.bind("focus",e.proxy(this._focus,this)),this.elements.input.bind("blur",e.proxy(this._blur,this)),this.elements.input.bind("keyup",e.proxy(this._keyup,this)),e(".oem").length>0&&(this.elements.clearIcon.bind("click",e.proxy(this._clearClick,this)),this.elements.clearIcon.bind("mouseenter",e.proxy(this._clearMouseEnter,this)),this.elements.clearIcon.bind("mouseleave",e.proxy(this._clearMouseLeave,this))),this.elements.input.bind("complete",e.proxy(function(){this.closeBubble();var e=this.elements.input[0],t=this.validateField(e);t.valid?(this.elements.parent.removeClass("hasError"),this.elements.input.attr("aria-invalid","false")):(this.elements.parent.addClass("hasError"),this.elements.input.attr("aria-invalid","true"))},this)),this.elements.input.bind("error",e.proxy(this.openError,this))},_load:function(){this.elements.input.val()?this.elements.input.addClass("userText"):this.elements.input.removeClass("userText")},_blur:function(){this._load(),this.closeBubble();var t=this.elements.input[0],n=this.validateField(t);this._emptyFieldRule(n),e(".oem").length>0&&(e(this).buttonToggle(),this.toggleClearIcon("blur",!1))},_keyup:function(){this._load(),this.closeBubble(),e(".oem").length>0&&this.toggleClearIcon("keyup",!0)},_clearClick:function(){var t=this.elements.clearIcon[0].id.split("_")[0];t!==undefined&&(e("#"+t).val("").focus(),this.elements.parent.addClass("focus"))},_clearMouseEnter:function(){e(this.elements.clearIcon).addClass("hovered")},_clearMouseLeave:function(){e(this.elements.clearIcon).removeClass("hovered")},_emptyFieldRule:function(e){e.valid?(this.elements.parent.removeClass("hasError"),this.elements.parent.removeClass("error-empty"),this.elements.parent.removeClass("error-format"),this.elements.input.attr("aria-invalid","false")):(e.error==="valueMissing"?(this.elements.parent.removeClass("error-format"),this.elements.parent.addClass("hasError error-empty")):(this.elements.parent.removeClass("error-empty"),this.elements.parent.addClass("hasError error-format")),this.elements.input.attr("aria-invalid","true"))},_focus:function(t){var n=e(t.currentTarget);n.attr("display-tooltip")!=="always"&&this.closeAllBubble();var r=this.elements.parent.hasClass("hasError");r?this.openError():this.openHelp(),e(".oem").length>0&&(e(this).buttonToggle(),this.toggleClearIcon("focus",!0))},openError:function(){var e=this.elements.input.attr("id");e&&e.length>0&&this.elements.input.attr("aria-describedby",e+"-help-error"),this.elements.parent.hasClass("error-format")?this.elements.formatError.addClass("open"):this.elements.parent.hasClass("error-empty")?this.elements.emptyError.addClass("open"):this.elements.parent.hasClass("error-custom")?this.elements.customError.addClass("open"):this.elements.submitError.addClass("open")},openHelp:function(){var e=this.elements.input.attr("id");e&&e.length>0&&this.elements.input.attr("aria-describedby",e+"-help-information"),this.elements.helpInformation.addClass("open")},closeBubble:function(){var e=this.elements.input.attr("id");e&&e.length>0&&this.elements.input.removeAttr("aria-describedby"),this.elements.helpErrors.removeClass("open"),this.elements.helpInformation.removeClass("open")},closeAllBubble:function(){e("p.open, div.open").removeClass("open")},validateField:function(e){if(e.checkValidity){if(!e.checkValidity()){var t="";for(t in e.validity)if(e.validity[t]===!0&&t!=="valid")return{valid:!1,error:t}}}else{var n={valueMissing:this.processRequired(),typeMismatch:!0,patternMismatch:this.processPattern(),rangeUnderflow:!0,rangeOverflow:!0,customError:!0};if(!n.valueMissing)return{valid:!1,error:"valueMissing"};if(!n.patternMismatch)return{valid:!1,error:"patternMismatch"}}return{valid:!0}},processRequired:function(){if(typeof this.elements.input.attr("required")!="undefined"){var t=this.elements.input.val();return t!==null&&e.trim(t).length>0?!0:!1}return!0},processPattern:function(){var e=this.elements.input;if(!e.attr("pattern"))return!0;var t=new RegExp("^"+e.attr("pattern")+"$");return t.test(e.val())},toggleClearIcon:function(t,n){var r=this.elements.input.parent().hasClass("focus"),i=this.elements.input.siblings(".focus"),s=this.elements.input.siblings(".hovered");n&&(r||i)?(e(".clearIcon").addClass("hide"),this.elements.input.val()!==""?(this.elements.clearIcon.addClass("active"),this.elements.clearIcon.removeClass("empty")):(this.elements.clearIcon.addClass("empty"),this.elements.clearIcon.removeClass("active")),this.elements.clearIcon.removeClass("hide")):s.length||e(".clearIcon").addClass("hide")}})});