define(["jquery","jqueryUI"],function(e){"use strict";var t=navigator.userAgent,n=/chrome/i.test(t),r=/android/i.test(t);e.widget("pp.phoneNumber",{options:{country:"US"},_getCreateOptions:function(){return{mobile:this.element.data("format-mobile"),home:this.element.data("format-home"),length:this.element.attr("maxlength"),digits:this.element.data("format-mobile").replace(/\W/g,"").length}},_create:function(){this._load(),this._addListeners(),r&&n&&this.element.bind("keyup",e.proxy(this._keyup,this))},_addListeners:function(){this.element.bind("keypress",e.proxy(this._numeric,this)),this.element.bind("keypress",e.proxy(this._restrict,this)),this.element.bind("keypress",e.proxy(this.formatPhoneNumberkeyStroke,this)),this.element.bind("keydown",e.proxy(this._keydown,this)),this.element.bind("paste",e.proxy(this._paste,this)),this.element.bind("blur",e.proxy(this._blur,this)),e("#phoneOption").bind("change",e.proxy(this._phoneType,this))},_load:function(){this.element.val().length===this.options.digits&&this.element.val(this.formatPhoneNumber(this.element.val())),this.element.val()!==""&&!this.element.parent().hasClass("hasError")&&this._blur()},_numeric:function(e){var t;return e.metaKey||e.ctrlKey?!0:e.which===32?!1:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},_restrict:function(t){var n,r,i;n=e(t.currentTarget),r=String.fromCharCode(t.which);if(!/^\d+$/.test(r))return;if(n.prop("selectionStart")!==null&&n.prop("selectionStart")!==n.prop("selectionEnd"))return;i=n.val()+r,i=i.replace(/\D/g,"");if(i.length>this.options.digits)return!1},_keydown:function(t){var n,i,s;if(t.meta)return;n=e(t.currentTarget),i=n.val();if(t.which!==8)return;if(n.prop("selectionStart")!==null&&n.prop("selectionStart")!==i.length)return;if(/\(\d$/.test(i))return t.preventDefault(),n.val("");/\d\)(\s)+$/.test(i)?(t.preventDefault(),n.val(i.replace(/\d\)(\s)*$/,"")),r&&(s=n.val(),n.value="",n.value=s)):/\d(\s|\-)\d{1}$/.test(i)?(t.preventDefault(),n.val(i.replace(/(\s|\-)\d{1}$/,"")),r&&(s=n.val(),n.value="",n.value=s)):/^\(\d{3}\)\s\d{1}$/.test(i)&&(n.val(i.replace(/\D/g,"")),r&&(s=n.val(),n.value="",n.value=s))},_blur:function(e){var t=this.element.val();if(r&&n&&t.length===this.options.digits){var i=this.formatPhoneNumber(t);this.element.val(i)}this._validate()},_phoneType:function(t){var n=this.element.val(),r=e("#phoneOption").val();n=n.replace(/\D/g,""),this.option("digits",this.options[r].replace(/\W/g,"").length);if(this.options.mobile!==this.options.home&&n.length===this.options.digits){var i=this.formatPhoneNumber(this.element.val());this.element.val(i),this._validate()}},_paste:function(e){var t=e.originalEvent.clipboardData.getData("Text");if(t.length){t=t.replace(/\D/g,""),t.length>this.options.digits&&(t=t.substr(0,this.options.digits));var n=this.formatPhoneNumber(t);this.element.val(n),e.preventDefault(),e.stopImmediatePropagation(),this._validate()}},_keyup:function(t){var n,i=e("#phoneOption").val(),s,o;n=e(t.currentTarget),s=n.val();switch(this.options[i]){case"X XXXX XXXX":if(/^\d{2}$/.test(s)){t.preventDefault(),s=s.replace(/\D/g,""),n.val(s.substr(0,1)+" "+s.substr(1,1)),r&&(o=n.val(),n.value="",n.value=o);return}break;case"XXX XXX XXX":case"XXX XXX XXXX":if(/^\d{4}$/.test(s)){t.preventDefault(),n.val(s.substr(0,3)+" "+s.substr(3,1)),r&&(o=n.val(),n.value="",n.value=o);return}if(/^\d{3}\s\d{3}$/.test(s)){t.preventDefault(),s=s.replace(/\D/g,""),n.val(s.substr(0,3)+" "+s.substr(3,3)+" "+s.substr(6,3)),r&&(o=n.val(),n.value="",n.value=o);return}break;case"(XXX) XX-XXXX":if(/^\d{4}$/.test(s)){t.preventDefault(),n.val("("+s.substr(0,3)+") "+s.substr(3,1)),r&&(o=n.val(),n.value="",n.value=o);return}if(/^\(\d{3}\)\s\d{4}$/.test(s)){t.preventDefault(),s=s.replace(/\D/g,""),n.val("("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6,4)),r&&(o=n.val(),n.value="",n.value=o);return}}},formatPhoneNumberkeyStroke:function(t){var n,i,s,o,u,a=e("#phoneOption").val();s=String.fromCharCode(t.which);if(!/^\d+$/.test(s))return;i=e(t.currentTarget),o=i.val(),u=o+s;switch(this.options[a]){case"X XXXX XXXX":if(/^\d{2}$/.test(u)||/^\d{1}\s\d{5}$/.test(u)){t.preventDefault(),i.val(""+o+" "+s),r&&(n=i.val(),i.value="",i.value=n);return}break;case"XXX XXX XXX":if(/^\d{4}$/.test(u)||/^\d{3}\s\d{4}$/.test(u)){t.preventDefault(),i.val(""+o+" "+s),r&&(n=i.val(),i.value="",i.value=n);return}break;case"XXX XXX XXXX":if(/^\d{4}$/.test(u)||/^\d{3}\s\d{4}$/.test(u)){t.preventDefault(),i.val(""+o+" "+s),r&&(n=i.val(),i.value="",i.value=n);return}break;case"XXX XXX XX XX":if(/^\d{4}$/.test(u)||/^\d{3}\s\d{4}$/.test(u)||/^\d{3}\s\d{3}\s\d{3}$/.test(u)){t.preventDefault(),i.val(""+o+" "+s),r&&(n=i.val(),i.value="",i.value=n);return}break;case"(XXX) XXX-XXXX":if(/^\d{4}$/.test(u)){t.preventDefault(),i.val("("+o+") "+s),r&&(n=i.val(),i.value="",i.value=n);return}if(/^\(\d{3}\)\s\d{4}$/.test(u)){t.preventDefault(),i.val(""+o+"-"+s),r&&(n=i.val(),i.value="",i.value=n);return}}},formatPhoneNumber:function(t){var n,r,i,s,o="",u=e("#phoneOption").val();return this.options[u]==="XXX XXX XXX"?s=t.replace(/\D/g,"").match(/^(\d{0,3})?(\d{0,3})?(\d{0,3})?$/):this.options[u]==="X XXXX XXXX"?s=t.replace(/\D/g,"").match(/^(\d{0,1})?(\d{0,4})?(\d{0,4})?$/):s=t.replace(/\D/g,"").match(/^(\d{0,3})?(\d{0,3})?(\d{0,4})?$/),n=s[1],r=s[2],i=s[3],n!==null&&n!==undefined&&(o+=this.options[u]==="(XXX) XXX-XXXX"?"("+n:n),(n!==null?n.length:void 0)===3&&(o+=this.options[u]==="(XXX) XXX-XXXX"?") ":" "),this.options[u]==="X XXXX XXXX"&&(n!==null?n.length:void 0)===1&&(o+=" "),r!==null&&r!==undefined&&(o+=""+r),(r!==null?r.length:void 0)===3&&(o+=this.options[u]==="(XXX) XXX-XXXX"?"-":" "),this.options[u]==="X XXXX XXXX"&&(r!==null?r.length:void 0)===4&&(o+=" "),i!==null&&i!==undefined&&(o+=""+i),o},_validate:function(){var t=this.element.val(),n=e("#phoneOption").val(),r;switch(this.options[n]){case"XXX XXX XXX":r=/^([0-9]{3})?[-. ]?([0-9]{3})[-. ]?([0-9]{3})$/;break;case"X XXXX XXXX":r=/^([0-9]{1})?[-. ]?([0-9]{4})[-. ]?([0-9]{4})$/;break;default:r=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/}r.test(t)?this.element.parent().removeClass("hasError"):this.element.parent().addClass("hasError")}})});